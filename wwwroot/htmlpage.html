<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Grouped Testing Results</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        h1 {
            text-align: center;
        }

        .task {
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .task-header {
            background: #f0f0f0;
            padding: 8px 10px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .run {
            margin-left: 20px;
            border-left: 2px solid #ddd;
            margin-top: 5px;
            padding-left: 10px;
        }

        .run-header {
            cursor: pointer;
            font-weight: bold;
            color: #333;
            display: flex;
            justify-content: space-between;
        }

        .test-items {
            margin-left: 20px;
            display: none;
        }

        .pass {
            color: green;
            font-weight: bold;
        }

        .fail {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Testing Results</h1>
    <div id="container"></div>

    <script>
        // Example data
        const testingData = [
            { taskId: 4390, run: 1, partNo: 595059, description: "DD608 TEST - 230V ELEMENT", result: "PASS" },
            { taskId: 4390, run: 1, partNo: 595063, description: "DD608 TEST - CHECK CONTROLLERS", result: "FAIL" },
            { taskId: 4390, run: 2, partNo: 595059, description: "DD608 TEST - 230V ELEMENT", result: "PASS" },
            { taskId: 4390, run: 2, partNo: 595063, description: "DD608 TEST - CHECK CONTROLLERS", result: "PASS" },
            { taskId: 4611, run: 1, partNo: 510947, description: "DD8 TEST DETERGENT DIVERTER", result: "PASS" },
            { taskId: 4611, run: 1, partNo: 595073, description: "DD8 TEST PACK CONTROLLER", result: "FAIL" },
            { taskId: 4611, run: 2, partNo: 510947, description: "DD8 TEST DETERGENT DIVERTER", result: "PASS" },
            { taskId: 4611, run: 2, partNo: 595073, description: "DD8 TEST PACK CONTROLLER", result: "PASS" },
            { taskId: 4611, run: 3, partNo: 510947, description: "DD8 TEST DETERGENT DIVERTER", result: "PASS" },
            { taskId: 4611, run: 3, partNo: 595073, description: "DD8 TEST PACK CONTROLLER", result: "PASS" },
        ];

        // Group by task then run
        const grouped = {};
        testingData.forEach(d => {
            if (!grouped[d.taskId]) grouped[d.taskId] = {};
            if (!grouped[d.taskId][d.run]) grouped[d.taskId][d.run] = [];
            grouped[d.taskId][d.run].push(d);
        });

        const container = document.getElementById('container');

        Object.keys(grouped).forEach((taskId, taskIndex) => {
            const taskDiv = document.createElement('div');
            taskDiv.className = 'task';

            // Determine latest run result for task
            const runs = Object.keys(grouped[taskId]).sort((a, b) => a - b);
            const latestRunItems = grouped[taskId][runs[runs.length - 1]];
            const latestPass = latestRunItems.every(i => i.result === "PASS");
            const latestResultClass = latestPass ? 'pass' : 'fail';

            // Task header
            const taskHeader = document.createElement('div');
            taskHeader.className = 'task-header';
            taskHeader.innerHTML = `<span>${taskIndex + 1}. TASK ${taskId}</span>
                                <span>Latest: <span class="${latestResultClass}">${latestPass ? 'PASS' : 'FAIL'}</span></span>`;
            taskDiv.appendChild(taskHeader);

            // Runs container
            const runsContainer = document.createElement('div');

            runs.forEach((runNum, runIndex) => {
                const runDiv = document.createElement('div');
                runDiv.className = 'run';

                // Determine run result
                const runItems = grouped[taskId][runNum];
                const runPass = runItems.every(i => i.result === "PASS");
                const runResultClass = runPass ? 'pass' : 'fail';

                const runHeader = document.createElement('div');
                runHeader.className = 'run-header';
                runHeader.innerHTML = `<span>${taskIndex + 1}. Run ${runNum}</span>
                                   <span class="${runResultClass}">${runPass ? 'PASS' : 'FAIL'}</span>`;
                runDiv.appendChild(runHeader);

                // Test items
                const itemsDiv = document.createElement('div');
                itemsDiv.className = 'test-items';

                runItems.forEach((item, itemIndex) => {
                    const span = document.createElement('div');
                    span.innerHTML = `${taskIndex + 1}.${runNum}.${itemIndex + 1} ${item.partNo} &nbsp;&nbsp; ${item.description} , <span class="${item.result.toLowerCase()}">${item.result}</span>`;
                    itemsDiv.appendChild(span);
                });

                // Toggle run items
                runHeader.addEventListener('click', () => {
                    itemsDiv.style.display = itemsDiv.style.display === 'block' ? 'none' : 'block';
                });

                runDiv.appendChild(itemsDiv);
                runsContainer.appendChild(runDiv);
            });

            // Toggle runs
            taskHeader.addEventListener('click', () => {
                runsContainer.style.display = runsContainer.style.display === 'block' ? 'none' : 'block';
            });

            taskDiv.appendChild(runsContainer);
            container.appendChild(taskDiv);
        });
    </script>
</body>
</html>
